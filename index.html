<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

</head>

<body>
        <div class = "container-fluid #d50000 red accent-4">
                <h1>
                  Netflix Movie Selector
                </h1>
              </div>
              
                <a class='dropdown-trigger btn' href='#' data-target='countries'>select your country</a>
              
                <!-- Dropdown Structure -->
                <ul id='countries' class='dropdown-content'>
              
                  <li><option value="23">Australia</option></li>
                  <li><option value="33">Canada</option></li>
                  <li><option value="327">Greece</option></li>
                  <li><option value="337">India</option></li>
                  <li><option value="55">Ireland</option></li>
                  <li><option value="391">Pakistan</option></li>
                  <li><option value="46">United Kingdom</option></li>
                  <li><option value="78">United States</option></li>
                </ul>
              </div>
              
              <a class='dropdown-trigger btn' href='#' data-target='genres'>select your genre</a>
              
              <!-- Dropdown Structure -->
              <ul id='genres' class='dropdown-content'
              >
                  <li><option value="801362">Action</option></li>
                  <li> <option value="7442">Adventure</option></li>
                  <li> <option value="7424">Anime</option></li>
                  <li><option value="6548">Comedy</option></li>
                  <li><option value="5763">Drama</option></li>
                  <li><option value="8711">Horror</option></li>
                  <li><option value="13335">Musical</option></li>
                 <li><option value="1255">Romance Drama</option></li>  
              </ul>
              
              </div>
              <button id="searchBtn">
                  Movie Search
              </button>

    </div>
    <a class="btn-floating pulse hey"><i class="material-icons">Click to watch now!</i></a>
        <div class="carousel carousel-slider center" style="height: 500px">
                <div class="carousel-fixed-item center">
                  <img src="https://broadcastingandmedia.com/img/logos/1550565848NetflixSmall.png" class="btn-floating pulse" style="width: 50px">
                </div>
          
        </div>
    
    <script>
        console.log(localStorage.getItem("history"));
        console.log(localStorage);
       
         function creatingCarousel (ajax) 
         {
        
              // starting dynamically creating carousel
                var i;
                for (i=0; i < ajax.ITEMS.length; i++) 
                {
                    //making carousel item div and giving it an id matching i and href matching the arr
                    var newDiv = $("<div>");
                    newDiv.addClass("carousel-item red white-text");
                    newDiv.css("border", "1px solid black");
                    newDiv.css("height", "500px");
                    var secondDiv = $("<div>");
                    secondDiv.addClass("valign-wrapper");
                    secondDiv.css("background-color", "black");
                    secondDiv.css("width", "85%");
                    secondDiv.css("position", "absolute");
                    secondDiv.css("top", "5%");
                    secondDiv.css("right", "5%");
                    secondDiv.css("border-radius", "4px");
                    secondDiv.css("border", "white solid 1px");
                    //making new image with movie poster from response
                    var newImage = $("<img>");
                    newImage.css("width", "300px");
                    newImage.css("border", "black 1px solid");
                    newImage.css("padding", "5px 5px 10px 5px");
                    console.log(ajax.ITEMS[i])
                    newImage.attr("src", ajax.ITEMS[i].image);

                    //making mini div with movie information
                    
                    var movieTitle = $("<h9>");
                    movieTitle.text(ajax.ITEMS[i].title);
                    var moviePlot = $("<p>");
                    moviePlot.text(ajax.ITEMS[i].synopsis);
                    var movieRating = $("<p>");
                    movieRating.text(ajax.ITEMS[i].rating + " /10 as chosen by IMBD users");
                    var movieLength = $("<p>");
                    movieLength.text(ajax.ITEMS[i].runtime);
                    
                    secondDiv.append(newImage);
                    secondDiv.append(movieTitle);
                    secondDiv.append(moviePlot);
                    secondDiv.append(movieRating);
                    secondDiv.append(movieLength);
                    newDiv.append(secondDiv);
                    $(".carousel").append(newDiv);
                }
           
                $('.carousel.carousel-slider').carousel(
                {
                    fullWidth: true,
                    indicators: true
                });    


        };

        var history = localStorage.getItem("history");
        if (history != "[Object object]") 
        { 
            // creatingCarousel(history)
        } else {

        }
        

        $("#searchBtn").on("click", function () 
        {
            $(".carousel").html("");
            var countryCode = $("#countries").val();
            var genreCode = $("#genres").val();
            var queryURL = "https://unogs-unogs-v1.p.rapidapi.com/aaapi.cgi?"

            queryURL += "q=get:new1000-"
            queryURL += "!1900,2018-"
            queryURL += "!0,5-"
            queryURL += "!0,10-"
            queryURL += "!" + genreCode + "-" 
            queryURL += "!Any-"
            queryURL += "!Any-"
            queryURL += "!Any-"
            queryURL += "!gt100-"
            queryURL += "!{ }"
            queryURL += "&t=ns"
            queryURL += "&cl=" + countryCode 
            queryURL += "&st=adv"
            queryURL += "&ob=Relevance"
            queryURL += "&p=1"
            queryURL += "&sa=and"

            var settings = 
            {
                "async": true,
                "crossDomain": true,
                "url": queryURL,
                "method": "GET",
                "headers": {
                    "x-rapidapi-host": "unogs-unogs-v1.p.rapidapi.com",
                    "x-rapidapi-key": "f1bd960599msh649fc643e8fdbcep118c63jsn3b463af5d748"
                }
            }
                  f42dc959c3fcbced717420fd247f1092735c1
            $.ajax(settings).done(function (response) 
            {
                localStorage.setItem("history", response);
                creatingCarousel(response);
            });

        })
        $('.dropdown-trigger').dropdown
        ({

        });
    </script>
</body>

</html>

