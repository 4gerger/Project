<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

</head>

<body>
    <div class="container-fluid #d50000 red accent-4 header">
        <h1>
            Netflix Movie Selector
        </h1>
    </div>
    <div class="pulse"></div>
    <div class="container-fluid searching">

        <div class="input-field col s6">
                        <select id ='countries'>
                          <option value="" disabled selected>Choose your country</option>
                          <option value="23">Australia</option>
                          <option value="33">Canada</option>
                          <option value="327">Greece</option>
                          <option value="337">India</option>
                          <option value="55">Ireland</option>
                          <option value="391">Pakistan</option>
                          <option value="46">United Kingdom</option>
                          <option value="78">United States</option>
                        </select>
                      </div>

        <div class="input-field col s6">
                <select id ='genres'>
                  <option value="" disabled selected>Choose your genre</option>
                  <option value="801362">Action</option>
                  <option value="7442">Adventure</option>
                  <option value="7424">Anime</option>
                  <option value="6548">Comedy</option>
                  <option value="5763">Drama</option>
                  <option value="8711">Horror</option>
                  <option value="13335">Musical</option>
                  <option value="1255">Romance Drama</option>
                </select>
              </div>


        <button id="searchBtn" class="btn">
            Movie Search
        </button>

   
    </div>
    <div class="carousel carousel-slider center" style="height: 500px">

    </div>

    <script>
        $(document).ready(function(){
            $('select').formSelect();
        });
        console.log(localStorage.getItem("history"));
        console.log(localStorage);
        function creatingCarousel(ajax) {
            // starting dynamically creating carousel
            var i;
            for (i = 0; i < ajax.ITEMS.length; i++) {
                //making carousel item div and giving it an id matching i and href matching the arr
                var newDiv = $("<div>");
                newDiv.addClass("carousel-item red white-text");
                newDiv.css("border", "1px solid black");
                newDiv.css("height", "500px");
                var secondDiv = $("<div>");
                secondDiv.addClass("valign-wrapper");
                secondDiv.css("background-color", "black");
                secondDiv.css("width", "85%");
                secondDiv.css("position", "absolute");
                secondDiv.css("top", "5%");
                secondDiv.css("right", "5%");
                secondDiv.css("border-radius", "4px");
                secondDiv.css("border", "white solid 1px");
                //making new image with movie poster from response
                var newImage = $("<img>");
                newImage.css("width", "300px");
                newImage.css("border", "black 1px solid");
                newImage.css("padding", "5px 5px 10px 5px");
                console.log(ajax.ITEMS[i])
                newImage.attr("src", ajax.ITEMS[i].image);
                //making mini div with movie information
                var movieTitle = $("<h9>");
                movieTitle.text(ajax.ITEMS[i].title);
                var moviePlot = $("<p>");
                moviePlot.text(ajax.ITEMS[i].synopsis);
                var movieRating = $("<p>");
                movieRating.text(ajax.ITEMS[i].rating + " /10 as chosen by IMBD users");
                var movieLength = $("<p>");
                movieLength.text(ajax.ITEMS[i].runtime);
                secondDiv.append(newImage);
                secondDiv.append(movieTitle);
                secondDiv.append(moviePlot);
                secondDiv.append(movieRating);
                secondDiv.append(movieLength);
                newDiv.append(secondDiv);
                $(".carousel").append(newDiv);
            }
            $('.carousel.carousel-slider').carousel(
                {
                    fullWidth: true,
                    indicators: true
                });
        };
        var history = localStorage.getItem("history");
        if (history != "[Object object]") {
            // creatingCarousel(history)
        } else {
        }
        $("#searchBtn").on("click", function () {
            $(".carousel").html("");
            var watchNowBtn = $("<a>");
            watchNowBtn.addClass("btn-floating pulse hey");
            var watchNowBtnAppearance = $("<i>");
            watchNowBtnAppearance.addClass("material-icons");
            watchNowBtnAppearance.text("Watch Random Now!");
            watchNowBtn.append(watchNowBtnAppearance);
            $(".pulse").append(watchNowBtn);
            var countryCode = $("#countries").val();
            console.log(countryCode);
            var genreCode = $("#genres").val();
            console.log(genreCode);
            var queryURL = "https://unogs-unogs-v1.p.rapidapi.com/aaapi.cgi?"
            queryURL += "q=get:new1000-"
            queryURL += "!1900,2018-"
            queryURL += "!0,5-"
            queryURL += "!0,10-"
            queryURL += "!" + genreCode + "-"
            queryURL += "!Any-"
            queryURL += "!Any-"
            queryURL += "!Any-"
            queryURL += "!gt100-"
            queryURL += "!{ }"
            queryURL += "&t=ns"
            queryURL += "&cl=" + countryCode
            queryURL += "&st=adv"
            queryURL += "&ob=Relevance"
            queryURL += "&p=1"
            queryURL += "&sa=and"
            var settings =
            {
                "async": true,
                "crossDomain": true,
                "url": queryURL,
                "method": "GET",
                "headers": {
                    "x-rapidapi-host": "unogs-unogs-v1.p.rapidapi.com",
                    "x-rapidapi-key": "f1bd960599msh649fc643e8fdbcep118c63jsn3b463af5d748"
                }
            }
            //f42dc959c3fcbced717420fd247f1092735c1
            $.ajax(settings).done(function (response) {
                localStorage.setItem("history", response);
                var randomArr = response.ITEMS.length;
                var whatMovie = Math.floor(Math.random() * randomArr);
                var btnTitle = response.ITEMS[whatMovie].netflixid;
                var btnURL = "https://www.netflix.com/watch/0?origId=" + btnTitle;
                watchNowBtn.attr('href', btnURL);
                console.log(btnURL);
                creatingCarousel(response);
            });
        })
        $('.dropdown-trigger').dropdown
            ({
            });
    </script>
</body>

</html>


    <!-- Object:
COUNT: "32"
ITEMS: Array(32)
0:
download: "1"
image: "https://occ-0-2219-2218.1.nflxso.net/dnm/api/v6/XsrytRUxks8BtTRf9HNlZkW2tvY/AAAABRiPIAVRnSybl_joINOjJw7FepvHyJyTXXC-kgc8fVnkdmKKbhozo1y8aX-t2g2dmELp3XKuNfOqaynTYMC0RuVesg.jpg?r=97c"
imdbid: "tt0116126"
largeimage: "http://cdn0.nflximg.net/images/4156/10924156.jpg"
netflixid: "452508"
rating: "6.6"
released: "1996"
runtime: "1h28m"
synopsis: "In this goofy send-up of the gritty urban movies of the early 1990s, Ashtray moves to South Central L.A. and falls in with his gang-banging cousin.<br><b>New on 2019-12-04</b>"
title: "Don&#39;t Be a Menace to South Central While Drinking Your Juice in the Hood"
type: "movie"
unogsdate: "2019-12-04" -->